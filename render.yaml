services:
  - type: web
    name: decided
    env: node
    plan: free
    buildCommand: "npm install && npm run build"
    startCommand: "npm start"
    healthCheckPath: "/api/health"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: decided-db
          property: connectionString
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: NEXT_PUBLIC_POSTHOG_KEY
        sync: false
      - key: NEXT_PUBLIC_POSTHOG_HOST
        sync: false
      - key: NODE_ENV
        value: production

  - type: pserv
    name: decided-db
    env: postgres
    plan: free
    disk:
      sizeGB: 1
    
databases:
  - name: decided-db
    postgres:
      version: 15

previews:
  - fromPullRequest:
      enabled: true
      services:
        - name: decided-preview
          type: web
          buildCommand: "npm install && npm run build"
          startCommand: "npm start"
          preDeployCommand: "npx drizzle-kit push"
          envVars:
            - key: DATABASE_URL
              fromDatabase:
                name: decided-db-preview
                property: connectionString
      databases:
        - name: decided-db-preview
          postgres:
            version: 15 